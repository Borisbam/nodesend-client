{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useReducer, useEffect, useRef } from 'react';\nimport authContext from './authContext';\nimport authReducer from './authReducer';\nimport { REGISTRO_EXITOSO, REGISTRO_ERROR, LIMPIAR_ALERTA, LOGIN_ERROR, LOGIN_EXITOSO, USUARIO_AUTENTICADO, CERRAR_SESION } from '../../types/index';\nimport clientAxios from '../../config/axios';\nimport tokenAuth from '../../config/tokenAuth';\nimport router from 'next/router';\n\nconst AuthState = ({\n  children\n}) => {\n  //Definir state inicial\n  const initialState = {\n    token: false ? localStorage.getItem('token') : null,\n    autenticado: null,\n    usuario: null,\n    mensaje: null\n  }; //Definir el reducer\n\n  const {\n    0: state,\n    1: dispatch\n  } = useReducer(authReducer, initialState); // Registrar usuario\n\n  const registrarUsuario = async datos => {\n    console.log(datos);\n\n    try {\n      const respuesta = await clientAxios.post('/api/users', datos);\n      dispatch({\n        type: REGISTRO_EXITOSO,\n        payload: respuesta.data.token\n      });\n      console.log(respuesta.data.token);\n      router.push('/');\n    } catch (error) {\n      dispatch({\n        type: REGISTRO_ERROR,\n        payload: error.response.data.msg\n      });\n    }\n  }; //Iniciar SesiÃ³n\n\n\n  const iniciarSesion = async datos => {\n    console.log(datos);\n\n    try {\n      const respuesta = await clientAxios.post('api/auth', datos);\n      dispatch({\n        type: LOGIN_EXITOSO,\n        payload: respuesta.data.token\n      });\n      router.push('/');\n    } catch (error) {\n      dispatch({\n        type: LOGIN_ERROR,\n        payload: error.response.data.msg\n      });\n    }\n  }; // Limpiar alerta\n\n\n  const isMounted = useRef(false);\n  useEffect(() => {\n    if (isMounted.current) {\n      const close = () => setTimeout(() => dispatch({\n        type: LIMPIAR_ALERTA\n      }), 3000);\n\n      const timerId = close();\n      return () => {\n        clearTimeout(timerId);\n      };\n    } else {\n      isMounted.current = true;\n    }\n  }, [state.mensaje]); // Retorna el usuario autenticado en base al JWT\n\n  const usuarioAutenticado = async () => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      tokenAuth(token);\n    }\n\n    try {\n      const respuesta = await clientAxios.get('/api/auth');\n\n      if (respuesta.data.user) {\n        dispatch({\n          type: USUARIO_AUTENTICADO,\n          payload: respuesta.data.user\n        });\n      }\n    } catch (error) {\n      dispatch({\n        type: LOGIN_ERROR,\n        payload: error.response.data.msg\n      });\n    }\n  }; // Cerrar sesion\n\n\n  const cerrarSesion = () => {\n    dispatch({\n      type: CERRAR_SESION\n    });\n  };\n\n  return /*#__PURE__*/_jsx(authContext.Provider, {\n    value: {\n      token: state.token,\n      autenticado: state.autenticado,\n      usuario: state.usuario,\n      mensaje: state.mensaje,\n      registrarUsuario,\n      iniciarSesion,\n      usuarioAutenticado,\n      cerrarSesion\n    },\n    children: children\n  });\n};\n\nexport default AuthState;","map":null,"metadata":{},"sourceType":"module"}