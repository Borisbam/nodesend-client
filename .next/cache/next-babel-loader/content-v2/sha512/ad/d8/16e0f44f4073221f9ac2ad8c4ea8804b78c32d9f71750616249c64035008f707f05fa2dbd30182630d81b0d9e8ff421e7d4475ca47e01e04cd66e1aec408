{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useReducer, useEffect, useRef } from 'react';\nimport authContext from './authContext';\nimport authReducer from './authReducer';\nimport { REGISTRO_EXITOSO, REGISTRO_ERROR, LIMPIAR_ALERTA, LOGIN_ERROR, LOGIN_EXITOSO, USUARIO_AUTENTICADO, CERRAR_SESION } from '../../types/index';\nimport clientAxios from '../../config/axios';\nimport tokenAuth from '../../config/tokenAuth';\nimport router from 'next/router';\n\nvar AuthState = function AuthState(_ref) {\n  var children = _ref.children;\n  //Definir state inicial\n  var initialState = {\n    token: true ? localStorage.getItem('token') : null,\n    autenticado: null,\n    usuario: null,\n    mensaje: null\n  }; //Definir el reducer\n\n  var _useReducer = useReducer(authReducer, initialState),\n      state = _useReducer[0],\n      dispatch = _useReducer[1]; // Registrar usuario\n\n\n  var registrarUsuario = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos) {\n      var respuesta;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(datos);\n              _context.prev = 1;\n              _context.next = 4;\n              return clientAxios.post('/api/users', datos);\n\n            case 4:\n              respuesta = _context.sent;\n              dispatch({\n                type: REGISTRO_EXITOSO,\n                payload: respuesta.data.token\n              });\n              console.log(respuesta.data.token);\n              router.push('/');\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](1);\n              dispatch({\n                type: REGISTRO_ERROR,\n                payload: _context.t0.response.data.msg\n              });\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 10]]);\n    }));\n\n    return function registrarUsuario(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(); //Iniciar Sesi√≥n\n\n\n  var iniciarSesion = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(datos) {\n      var respuesta;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(datos);\n              _context2.prev = 1;\n              _context2.next = 4;\n              return clientAxios.post('api/auth', datos);\n\n            case 4:\n              respuesta = _context2.sent;\n              dispatch({\n                type: LOGIN_EXITOSO,\n                payload: respuesta.data.token\n              });\n              router.push('/');\n              _context2.next = 12;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](1);\n              dispatch({\n                type: LOGIN_ERROR,\n                payload: _context2.t0.response.data.msg\n              });\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 9]]);\n    }));\n\n    return function iniciarSesion(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // Limpiar alerta\n\n\n  var isMounted = useRef(false);\n  useEffect(function () {\n    if (isMounted.current) {\n      var close = function close() {\n        return setTimeout(function () {\n          return dispatch({\n            type: LIMPIAR_ALERTA\n          });\n        }, 3000);\n      };\n\n      var timerId = close();\n      return function () {\n        clearTimeout(timerId);\n      };\n    } else {\n      isMounted.current = true;\n    }\n  }, [state.mensaje]); // Retorna el usuario autenticado en base al JWT\n\n  var usuarioAutenticado = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var token, respuesta;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              token = localStorage.getItem('token');\n\n              if (token) {\n                tokenAuth(token);\n              }\n\n              _context3.prev = 2;\n              _context3.next = 5;\n              return clientAxios.get('/api/auth');\n\n            case 5:\n              respuesta = _context3.sent;\n\n              if (respuesta.data.user) {\n                dispatch({\n                  type: USUARIO_AUTENTICADO,\n                  payload: respuesta.data.user\n                });\n              }\n\n              _context3.next = 12;\n              break;\n\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](2);\n              dispatch({\n                type: LOGIN_ERROR,\n                payload: _context3.t0.response.data.msg\n              });\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[2, 9]]);\n    }));\n\n    return function usuarioAutenticado() {\n      return _ref4.apply(this, arguments);\n    };\n  }(); // Cerrar sesion\n\n\n  var cerrarSesion = function cerrarSesion() {\n    dispatch({\n      type: CERRAR_SESION\n    });\n  };\n\n  return /*#__PURE__*/_jsx(authContext.Provider, {\n    value: {\n      token: state.token,\n      autenticado: state.autenticado,\n      usuario: state.usuario,\n      mensaje: state.mensaje,\n      registrarUsuario: registrarUsuario,\n      iniciarSesion: iniciarSesion,\n      usuarioAutenticado: usuarioAutenticado,\n      cerrarSesion: cerrarSesion\n    },\n    children: children\n  });\n};\n\nexport default AuthState;","map":null,"metadata":{},"sourceType":"module"}